<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Generalisation of FizzBuzz Problem</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="Generalisation of FizzBuzz Problem"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2014-11-01T18:25+0800"/>
<meta name="author" content="Caleb"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style><link rel="stylesheet" href="/style.css" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js">
/**
 *
 * @source: http://orgmode.org/mathjax/MathJax.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in http://orgmode.org/mathjax/MathJax.js.
 *
 * Copyright (C) 2012-2013  MathJax
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in http://orgmode.org/mathjax/MathJax.js.
 *
 */

/*
@licstart  The following is the entire license notice for the
JavaScript code below.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code below is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code below.
*/
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>

<div id="preamble">
<h1 id="headline">Categorical Ethos</h1>
                         <ul id="nav"> 
                         <li><a href="/">HOME</a></li>
                         <li><a href="https://github.com/catethos/">GITHUB</a></li>
                         </ul>
                         
</div>

<div id="content">
<h1 class="title">Generalisation of FizzBuzz Problem</h1>

<p>The original FizzBuzz problem is to write a function that takes a natural number \(n\) 
and return "Fizz", "Buzz", or \(n\) itself depends on whether \(n\) is divisible by 3, 5, both of them, and neither of them.
\[
f(n) = 
\begin{cases}
\text{Fizz} & \text{ if } n \% 3=0 \\
\text{Buzz} & \text{ if } n \% 5=0 \\
\text{FizzBuzz} & \text{ if } n\%3=0 \text{ and } n\%5=0 \\
n & \text{otherwise}
\end{cases}
\]
It can be easily genaralised to:
\[
f(n) = 
\begin{cases}
output_1 & \text{ if } condition_1 \\
output_2 & \text{ if } condition_2 \\
...\\
output_n & \text{ if } condition_n \\
output_{n+1} & \text{otherwise}
\end{cases}
\]

The most natural solution is:
</p>



<pre class="example">def fizzbuzz1(n):
    if n%3==0 and n%5==0:
        return "FizzBuzz"
    elif n%5==0:
        return "Buzz"
    elif n%3==0:
        return "Fizz"
    else:
        return n    
</pre>


<p>
The problems of this solution are
</p>
<ol>
<li>The order of the conditions is significant. 
</li>
</ol>

<p>Suppose we test for the divisibility of individual digit
before both of them, we would not get "FizzBuzz" at all.
</p><ol>
<li>The conditions of divisible by 3 and that by 5 sometime are tested twice.
</li>
</ol>


<p>
With a little number theory, the first condition can be simplify to \(n\%15=0\) 
as shown in **fizzbuzz2** and the second problem will be gone.
It is simple in this case to construct a simple condition that is the conjunction of two others.
However it will be more difficult when we generalise the problem and there are more condtions to be considered, 
in which case the number of combination of conditions will increase exponentially and the hope of finding
a simpler condition which is equivalent to the combination will decrease exponentially.
</p>



<pre class="example">def fizzbuzz2(n):
    if n%15==0:
        return "FizzBuzz"
    elif n%5==0:
        return "Buzz"
    elif n%3==0:
        return "Fizz"
    else:
        return n
</pre>


<p>
The decision flow of the program can be visualised by the tree below
</p>
<p>
<img src="../images/ltree.png"  alt="../images/ltree.png" />
</p>
<p>
And the tree can be rebalanced as below
</p>
<p>
<img src="../images/btree.png"  alt="../images/btree.png" />
</p>
<p>
Translating directly from the tree, we can write the function in a highly nested form.
</p>



<pre class="example">def fizzbuzz3(n):
    if n%3==0:
        if n%5==0:
            return "FizzBuzz"
        else:
            return "Fizz"
    else:
        if n%5==0:
            return "Buzz"
        else:
            return n
</pre>


<p>
If we disregard efficientcy, the function can be rewritten in a symetrical form in the sense that
the if clauses can be rearranged at will.
</p>



<pre class="example">def fizzbuzz4(n):
    if n%3==0 and n%5==0:
        return "FizzBuzz"
    if n%5==0 and n%3!=0:
        return "Buzz"
    if n%3==0 and n%5!=0:
        return "Fizz"
    if n%3!=0 and n%5!=0:
        return n
</pre>


<p>
In fact **fizzbuzz3** is the most natural way to write the function given the problem is expressed in the
term of a binary decision tree. But the highly nested structure prevents us from generalising
the solution into problem involved more than 2 conditions.
</p>
<p>
**fizzbuzz4** offers us a natural way to generalise the solution. We just have to add more if-clauses. 
Besides being extremely tedious, for if there are \(n\) conditions, then we need to write \(n\) if-clauses
to cover all the cases. Not the mention it is highly inefficient to test for the same condition 
over and over again and disregard the fact that \(n\%k=0\) and \(n\%k \neq 0\) is mutually exclusive.
</p>
<p>
We can do better by thinking in a functional way. The function \(f\) can be viewed as a series of transformation:
</p>


\[
n \rightarrow (n\%3==0,\text{ }n\%5==0)::(boolean,boolean) \rightarrow result
\]

<p>
The input \(n\) is transformed into a pair of boolean value indicated which condition is satisfied by it. 
The output of the function can be characterised as a direct mapping from the boolean pair into the desired output value.
**fizzbuzz5** implements the idea above. 
</p>



<pre class="example">def fizzbuzz5(n):
    booleanArray = ["0","0"]
    mapping = {"11":"FizzBuzz",
               "10":"Fizz",
               "01":"Buzz",
               "00": n}
    if n%3 == 0:
        booleanArray[0] = "1"
    if n%5 == 0:
        booleanArray[1] = "1"
    index = "".join(booleanArray)    
    return mapping[index]
</pre>


<p>
The function can be easily generalised by using booleanArray of more that 2 elements,
adding more item into the mapping, and add more if-clauses. The benefit of **fizzbuzz5** is that if there are \(n\) basic conditions, and all the conditions are generated by the various combination of these basic combination, we only have to write
\(n\) if-clauses. Whereas **fizzbuzz4** would require \(2^n\) if-clauses, the depth of **fizzbuzz3** would be of order \(n\), and **fizzbuzz2** as well as **fizzbuzz1** can't be generalised easily.
</p>
<p>
However, the mapping of booleanArray to the desired value still consists of \(2^n\) values.
This condition can't be improved if the desired values are independent from each other.
In this case, however, the result can be seen as a combination of some basic result, i.e.
the 2 basic results are "Fizz" and "Buzz", and the other result is the concatenation of the 2 strings.
In other word, the problem can be simplified if
there are some basic conditions, their corresponding basic desired output 
and the result of the combination of basic conditions is also 
the combination of basic desired output.
</p>
<p>
In symbol:
</p>


\[
\begin{align}
c_1 &\rightarrow o_1 \\ 
c_2 &\rightarrow o_2 \\
&...\\
c_n &\rightarrow o_n \\ 

(((c_i \wedge c_j) \wedge ...) \wedge c_k) &\rightarrow (((o_i \oplus o_j) \oplus ...) \oplus o_k)
\end{align}
\]

\(c_i \wedge c_j\) denotes the conjunction of \(c_i\) and \(c_j\), i.e. (\(a\) and \(b\)). \(o_i \oplus o_j\) denotes the combination of output \(o_i\) and \(o_j\)
<p>
Imagine that, given a number \(n\), we scan through the conditions and build up the desired output according to which conditions are satisfied by \(n\).
</p>
<p>
In the following code, \(\oplus\) is just string concatenation.
</p>



<pre class="example">def fizzbuzz6(n):
    result = ""
    if n%3==0:
        result += "Fizz"
    if n%5==0:
        result += "Buzz"
    if result == "":
        result = n
    return result    
</pre>


<p>
We can refactor the code and get a more general solution.
</p>
<p>
We represent the conditions by functions:
</p>



<pre class="example">def c1(n):
    return n % 3 == 0
def c2(n):
    return n % 5 == 0
</pre>


<p>
Similarly for the output:
</p>



<pre class="example">def o1():
    return "Fizz"
def o2():
    return "Buzz"
</pre>


<p>
Collect the basic conditions and outputs into a mapping.
</p>



<pre class="example">from collections import OrderedDict
cePair = OrderedDict({c1:o1,
                      c2:o2})
</pre>


<p>
Define the appropriate \(combine\) function
</p>



<pre class="example">def combine(x,y):
    try:
        return x + y
    except TypeError:
        return y
</pre>


<p>
And finally the function can be written as:
</p>



<pre class="example">def fizzbuzz7(n):
    initial = n
    for c, e in cePair.items():
        if c(n):
            initial = combine(initial,e())
    return initial
</pre>


<p>
Now the fizzbuzz function can be generalized to
including more conditions and results
by just adding more elements into 
the list <code>cePair</code>, without having to touch
the function body.
</p>
<p>
Just to show that all versions of the function are the same:
</p>



<pre class="example">list1 = [fizzbuzz1(x) for x in range(1,101)]
list2 = [fizzbuzz2(x) for x in range(1,101)]
list3 = [fizzbuzz3(x) for x in range(1,101)]
list4 = [fizzbuzz4(x) for x in range(1,101)]
list5 = [fizzbuzz5(x) for x in range(1,101)]
list6 = [fizzbuzz6(x) for x in range(1,101)]
list7 = [fizzbuzz7(x) for x in range(1,101)]

assert list1 == list2
assert list2 == list3
assert list3 == list4
assert list4 == list5
assert list6 == list7
</pre>


<p>
This blog post is also in the form of
a ipython notebook. 
You can view and download the notebook 
<a href="http://nbviewer.ipython.org/github/catethos/notebooks/blob/master/Generalisation of FizzBuzz.ipynb">here</a>.
</p></div>

<div id="postamble">
<div id='disqus_thread'></div>
                          <script type='text/javascript'>
                          /** CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE***/
                          var disqus_shortname = 'catethos'; // required: replace example with your forum shortname
                          /*** DON'T EDIT BELOW THIS LINE***/
                          (function() {
                              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                              if (window.location.pathname != '/'){
                              (document.getElementsByTagName('body')[0]).appendChild(dsq)};
                          })();
                     </script>
                     <noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a></noscript>
</div>
</body>
</html>
